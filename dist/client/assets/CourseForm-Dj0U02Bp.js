import{r as c,u as U,a as I,b as V,c as q,d as S,j as e,C as i,F as M,e as R,I as m,D as W,T as E,f as H,g as T,h as $,i as f,E as K,k as z,l as J,m as X,n as Y,S as h,o as G,p as Q}from"./index-BlaCQYdb.js";const re=()=>{const[n,O]=c.useState(null),[j,N]=c.useState(!1),[b,y]=c.useState(!!n?.trainingPlan),[Z,ee]=c.useState(!0),[w,v]=c.useState(""),[P,A]=c.useState(""),[se,te]=c.useState([]),{token:ae}=U(),g=I(),{id:u}=V(),C={title:"",description:"",duration:"",rating:0,enrolledCount:0,overview:"",learningOutcomes:[],benefits:[],features:{certificate:!1,codingExercises:!1,recordedLectures:!1},keyFeatures:[{title:"",description:"",subPoints:[""]}],fees:"",durationValue:"",durationUnit:"days",trainingPlan:null},_=()=>{if(!n)return C;const s=n.duration?.match(/^(\d+)\s*(days|weeks|months|years)$/i),t=s?s[1]:"",l=s?s[2].toLowerCase():"days";return{...C,...n,durationValue:t,durationUnit:l,rating:n.rating||0,enrolledCount:n.enrolledCount||0,overview:n.overview||"",learningOutcomes:n.learningOutcomes?.length?n.learningOutcomes:[""],benefits:n.benefits?.length?n.benefits:[""],features:n.features||{certificate:!1,codingExercises:!1,recordedLectures:!1},keyFeatures:n.keyFeatures?.length?n.keyFeatures:[{title:"",description:"",subPoints:[""]}],instructor:n.instructor||"",fees:n.fees||"",trainingPlan:null,trainingPlanUrl:n.trainingPlan?Q.TRAINING_PLAN+n.trainingPlan.fileName:""}},k=q().shape({title:S().required("Title is required"),description:S().required("Description is required")});c.useEffect(()=>{(async()=>{if(u)try{const t=await X(u);O(t)}catch(t){v(`Failed to load ${i} for editing.`),console.error(`Error fetching ${i}:`,t)}})()},[u]);const D=s=>s?.filter(t=>t&&t.trim()!=="")||[],L=s=>s?.map(t=>{const l=t.subPoints?.filter(a=>a&&a.trim()!=="");return t.title&&t.title.trim()!==""||t.description&&t.description.trim()!==""||l&&l.length?{title:t.title||"",description:t.description||"",subPoints:l||[]}:null}).filter(t=>t!==null),B=async(s,{setSubmitting:t,resetForm:l})=>{v(""),A(""),N(!0);try{const a=new FormData;a.append("title",s.title),a.append("description",s.description),a.append("duration",`${s.durationValue} ${s.durationUnit}`),a.append("rating",s.rating),a.append("enrolledCount",s.enrolledCount),a.append("overview",s.overview),a.append("fees",s.fees),a.append("keyFeatures",JSON.stringify(L(s.keyFeatures))),a.append("learningOutcomes",JSON.stringify(D(s.learningOutcomes))),a.append("benefits",JSON.stringify(D(s.benefits))),b&&s.trainingPlan?a.append("trainingPlan",s.trainingPlan):b||a.append("trainingPlan","");let r;if(u&&n)r=await Y(u,a),h.fire({icon:"success",title:"Updated!",text:`${i} updated successfully!`}),g("/manage-courses");else{r=await G(a),h.fire({icon:"success",title:"Created!",text:`${i} created successfully!`});const x=r?.data?._id,p=await h.fire({title:`${i} created successfully! What would you like to do next?`,showDenyButton:!0,showCancelButton:!0,confirmButtonText:`Add New ${i}`,denyButtonText:"Show List",cancelButtonText:"Add Batch"});let d;switch(p.isConfirmed?d="ADD_NEW":p.isDenied?d="SHOW_LIST":p.isDismissed&&(d="ADD_BATCH"),d){case"ADD_NEW":g("/add-courses");break;case"SHOW_LIST":g("/manage-courses");break;case"ADD_BATCH":x&&g(`/add-batch?courseId=${x}`);break;default:console.log("No action taken")}}l()}catch(a){const r=a?.message||a?.response?.data?.message||"Operation failed.";h.fire({icon:"error",title:"Oops...",text:r}),console.error(`Error submitting ${i}:`,a)}N(!1),t(!1)};return c.useEffect(()=>{n?.trainingPlan&&y(!0)},[n]),e.jsxs("div",{className:"max-w-6xl mx-auto p-8 bg-white shadow-xl rounded-xl border-2 border-blue-700 border-opacity-80",children:[e.jsx("div",{className:"flex justify-between items-center mb-8 border-b border-gray-200 pb-4",children:e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:u?`Edit ${i}`:`Create New ${i}`})}),w&&e.jsx("div",{className:"mb-6 p-4 bg-red-100 text-red-700 border border-red-400 rounded-lg",children:w}),P&&e.jsx("div",{className:"mb-6 p-4 bg-green-100 text-green-700 border border-green-400 rounded-lg",children:P}),e.jsx(M,{enableReinitialize:!0,initialValues:_(),validationSchema:k,onSubmit:B,children:s=>e.jsxs(R,{className:"space-y-10",children:[e.jsxs("section",{className:"space-y-6 bg-blue-50 p-6 rounded-lg",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 border-b border-gray-200 pb-2",children:"Basic Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(m,{label:"Title*",name:"title",formik:s}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx(m,{label:"Duration Value*",name:"durationValue",type:"number",formik:s}),e.jsx(W,{label:"Duration Unit*",name:"durationUnit",options:[{_id:"days",title:"Days"},{_id:"weeks",title:"Weeks"},{_id:"months",title:"Months"},{_id:"years",title:"Years"}],formik:s})]})]}),e.jsx(E,{label:"Description*",name:"description",rows:4,formik:s})]}),e.jsxs("section",{className:"space-y-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-800 border-b border-gray-200 pb-2",children:[i," Details"]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-6",children:[e.jsx(m,{label:"Rating (optional)",name:"rating",type:"number",formik:s}),e.jsx(m,{label:"Enrolled Count (optional)",name:"enrolledCount",type:"number",formik:s}),e.jsx(m,{label:"Fees (optional)",name:"fees",type:"number",formik:s}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-800 mb-2",children:"Do you want to add a training plan?"}),e.jsxs("div",{className:"flex items-center space-x-6",children:[e.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"addTrainingPlan",value:"yes",checked:b===!0,onChange:()=>y(!0)}),e.jsx("span",{children:"Yes"})]}),e.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"addTrainingPlan",value:"no",checked:b===!1,onChange:()=>y(!1)}),e.jsx("span",{children:"No"})]})]})]}),b&&e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-800 mb-2",children:"Training Plan (PDF / DOCX / XLSX) (optional)"}),e.jsxs("div",{className:"relative w-full",children:[e.jsx("input",{type:"file",name:"trainingPlan",id:"trainingPlan",accept:".pdf,.docx,.xlsx",onChange:t=>s.setFieldValue("trainingPlan",t.target.files[0]),className:"absolute inset-0 opacity-0 cursor-pointer z-20"}),e.jsxs("div",{className:"flex items-center justify-between border-2 border-dashed border-gray-300 bg-white px-4 py-3 rounded-lg shadow-sm hover:border-blue-400 transition-all duration-300 z-10",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(H,{className:"text-blue-600"}),e.jsx("span",{className:"text-gray-700 font-medium truncate max-w-[300px]",children:s.values.trainingPlan?s.values.trainingPlan.name:"Choose a file..."})]}),e.jsx("span",{className:"text-sm text-gray-500 hidden md:block",children:"Max: 5MB"})]})]}),s.values.trainingPlanUrl&&!s.values.trainingPlan&&e.jsx("div",{className:"mt-3",children:e.jsx("a",{href:s.values.trainingPlanUrl,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 underline font-medium",children:"View Existing Training Plan"})}),s.touched.trainingPlan&&s.errors.trainingPlan&&e.jsx("div",{className:"text-red-500 text-sm font-medium mt-1",children:s.errors.trainingPlan})]})]}),e.jsx(E,{label:"Overview (optional)",name:"overview",rows:4,formik:s})]}),e.jsxs("section",{className:"space-y-6 bg-blue-50 p-6 rounded-lg",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 border-b border-gray-200 pb-2",children:"Learning Outcomes"}),e.jsx(T,{formik:s,name:"learningOutcomes",label:"Learning Outcomes (optional)"})]}),e.jsxs("section",{className:"space-y-6 bg-blue-50 p-6 rounded-lg",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-800 border-b border-gray-200 pb-2",children:["Benefits (Why Take This ",i,"?)"]}),e.jsx(T,{formik:s,name:"benefits",label:"Benefits (optional)"})]}),e.jsxs("section",{className:"space-y-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 border-b border-gray-200 pb-2",children:"Prerequisite"}),e.jsx($,{name:"keyFeatures",children:({push:t,remove:l})=>e.jsxs("div",{className:"space-y-6",children:[s.values.keyFeatures.map((a,r)=>e.jsxs("div",{className:"p-5 border border-blue-400 rounded-lg bg-white shadow-sm",children:[e.jsxs("div",{className:"flex justify-between items-center mb-3",children:[e.jsxs("h4",{className:"font-semibold text-blue-700",children:["Prerequisite ",r+1]}),e.jsx("button",{type:"button",className:"px-3 py-1 bg-red-500 text-white rounded hover:bg-red-600",onClick:()=>l(r),disabled:s.values.keyFeatures.length===1,children:"Remove"})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Title (optional)"}),e.jsx(f,{name:`keyFeatures[${r}].title`,className:"w-full px-3 py-2 border border-blue-400 rounded-md",onKeyDown:o=>{o.key==="Enter"&&(o.preventDefault(),t({title:"",description:"",subPoints:[""]}))}}),e.jsx(K,{name:`keyFeatures[${r}].title`,component:"div",className:"text-xs text-red-500 mt-1"})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Description (optional)"}),e.jsx(f,{as:"textarea",name:`keyFeatures[${r}].description`,rows:"2",className:"w-full px-3 py-2 border border-blue-400 rounded-md",onKeyDown:o=>{o.key==="Enter"&&(o.preventDefault(),t({title:"",description:"",subPoints:[""]}))}})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 font-medium text-gray-700",children:"Sub Points (optional)"}),e.jsx($,{name:`keyFeatures[${r}].subPoints`,children:({push:o,remove:x})=>e.jsx("div",{className:"space-y-2",children:a.subPoints?.map((p,d)=>e.jsxs("div",{className:"flex gap-2",children:[e.jsx(f,{name:`keyFeatures[${r}].subPoints[${d}]`,className:"flex-1 px-3 py-2 border border-blue-400 rounded-md",onKeyDown:F=>{F.key==="Enter"&&(F.preventDefault(),o(""))}}),e.jsx("button",{type:"button",className:"px-3 py-1 bg-red-500 text-white rounded hover:bg-red-600",onClick:()=>x(d),disabled:a.subPoints.length===1,children:e.jsx(z,{})}),d===a.subPoints.length-1&&e.jsx("button",{type:"button",className:"px-3 py-1 bg-green-500 text-white rounded hover:bg-green-600",onClick:()=>o(""),children:e.jsx(J,{})})]},d))})})]})]},r)),e.jsx("button",{type:"button",className:"px-6 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700",onClick:()=>t({title:"",description:"",subPoints:[""]}),children:"Add Prerequisite"})]})})]}),e.jsx("div",{className:"flex justify-end gap-4 pt-6 border-t border-gray-200",children:e.jsx("button",{type:"submit",disabled:s.isSubmitting||j,className:"px-8 py-3 bg-green-600 hover:bg-green-700 text-white font-semibold rounded-lg shadow-lg transition disabled:opacity-50",children:s.isSubmitting||j?n?"Updating...":"Creating...":n?`Update ${i}`:`Create ${i}`})})]})})]})};export{re as default};
