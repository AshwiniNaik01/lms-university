import{r as d,q as E,a as _,L as D,j as e,w as r,C as h,t as P,M as V,v as L,S as i,c8 as y,a6 as T,aI as O,c9 as R}from"./index-BlaCQYdb.js";const U=()=>{const[j,x]=d.useState([]),[N,w]=d.useState([]),[B,u]=d.useState("all"),[C,m]=d.useState(""),[c,v]=d.useState(null),[$,g]=d.useState(!1),{rolePermissions:n}=E(t=>t.permissions),l=_(),b=D(),p=async()=>{try{const t=await y();x(t),m(t.length===0?"No batches available":"")}catch(t){m(t.message),i.fire({icon:"error",title:"Failed to Fetch Batches",text:t.message,confirmButtonColor:"#3085d6"})}},f=async t=>{try{if(t==="all"){const a=await y();x(a),m(a.length===0?"No batches available":"");return}const s=await T(t);s.length>0?(x(s),m("")):(x([]),m(`No batches found for this ${h}`),i.fire({icon:"info",title:"No Batches Found",text:`No batches found for this selected ${h}.`,confirmButtonColor:"#3085d6"}))}catch(s){x([]),m(s.message),i.fire({icon:"error",title:`Error Fetching ${h} Batches`,text:s.message,confirmButtonColor:"#d33"})}};d.useEffect(()=>{(async()=>{try{const s=await L();w(s||[]);const o=new URLSearchParams(b.search).get("courseId");o&&s.some(A=>A._id===o)?(u(o),await f(o)):(u("all"),await p())}catch(s){i.fire({icon:"error",title:`Error Fetching ${h}`,text:s.response?.data?.message||s.message,confirmButtonColor:"#d33"})}})()},[b.search]);const k=async t=>{if((await i.fire({title:"Are you sure?",text:"This action will permanently delete the batch!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Yes, delete it!"})).isConfirmed)try{await R(t),p(),i.fire({icon:"success",title:"Deleted!",text:"Batch has been deleted successfully.",timer:1800,showConfirmButton:!1})}catch(a){const o=a.response?.data?.message||"Failed to delete batch";i.fire({icon:"error",title:"Delete Failed",text:o})}},I=async t=>{try{const s=await O(t);v(s),g(!0)}catch(s){const a=s.response?.data?.message||"Failed to fetch batch details";i.fire({icon:"warning",title:"Error Fetching Details",text:a,confirmButtonColor:"#d33"})}},F=t=>l(`/add-batch/${t}`),M=t=>{const s=t.target.value;u(s),f(s)},S=[{header:"Batch Name",accessor:t=>t.batchName||"-"},{header:"Time",accessor:t=>`${t.time?.start||"-"} - ${t.time?.end||"-"}`},{header:"Mode",accessor:t=>t.mode||"-"},{header:"Actions",accessor:t=>{const s=t._id,a=t.coursesAssigned?.map(o=>o._id).join(",");return e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>I(s),className:"px-2 py-1 rounded-md bg-blue-500 text-white hover:bg-blue-600 text-sm",children:"View"}),r(n,"batch","update")&&e.jsx("button",{onClick:()=>F(s),className:"px-2 py-1 rounded-md bg-yellow-500 text-white hover:bg-yellow-600 text-sm",children:"Edit"}),r(n,"batch","delete")&&e.jsx("button",{onClick:()=>k(s),className:"px-2 py-1 rounded-md bg-red-500 text-white hover:bg-red-600 text-sm",children:"Delete"}),r(n,"enrollment","create")&&e.jsx("button",{onClick:()=>l(`/enrollments/upload-excel?batchId=${s}&courseIds=${a}`),className:"px-2 py-1 rounded-md bg-green-500 text-white hover:bg-green-600 text-sm",children:"Add Participate"}),r(n,"enrollment","read")&&e.jsx("button",{onClick:()=>l(`/enrolled-student-list?b_id=${s}`),className:"px-2 py-1 rounded-md bg-purple-500 text-white hover:bg-purple-600 text-sm",children:"View Participate"}),r(n,"feedback","create")&&e.jsx("button",{onClick:()=>window.location.href=`/create-feedback?batchId=${s}&courseId=${a}`,className:"px-2 py-1 rounded-md bg-indigo-500 text-white hover:bg-indigo-600 text-sm",children:"Create Feedback"}),r(n,"enrollment","read")&&e.jsx("button",{onClick:()=>l(`/manage-feedback?b_id=${s}&courseId=${a}`),className:"px-2 py-1 rounded-md bg-orange-500 text-white hover:bg-orange-600 text-sm",children:"View Feedback"}),r(n,"assignment","read")&&e.jsx("button",{onClick:()=>l(`/manage-assignments?b_id=${s}&courseId=${a}`),className:"px-2 py-1 rounded-md bg-pink-500 text-white hover:bg-pink-600 text-sm",children:"View Assignment"}),r(n,"test","read")&&e.jsx("button",{onClick:()=>l(`/view-tests/batch/${s}`),className:"px-2 py-1 rounded-md bg-emerald-500 text-white hover:bg-emerald-600 text-sm",children:"View Assessment"})]})}}];return e.jsxs("div",{className:"p-8 font-sans bg-white max-h-screen",children:[e.jsxs("div",{className:"flex justify-between items-center mb-8",children:[e.jsx("h2",{className:"text-3xl font-semibold text-gray-800",children:"Manage Batches"}),e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("label",{className:"font-semibold text-gray-700",children:["Filter by ",h,":"]}),e.jsxs("select",{value:B,onChange:M,className:"p-2 border rounded-md border-gray-300",children:[e.jsxs("option",{value:"all",children:["All ",h]}),N.map(t=>e.jsx("option",{value:t._id,children:t.title},t._id))]})]}),r(n,"batch","create")&&e.jsx("button",{onClick:()=>l("/add-batch"),className:"bg-cyan-500 hover:bg-cyan-600 text-white font-bold px-4 py-2 rounded-lg transition",children:"+ Create Batch"})]})]}),e.jsx(P,{columns:S,data:j,maxHeight:"600px",emptyMessage:C||"No batches found"}),e.jsx(V,{isOpen:$,onClose:()=>g(!1),header:c?`Batch: ${c.batchName}`:"Batch Details",children:c?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-gray-600",children:[e.jsx("strong",{children:"Time:"})," ",c.time?.start||"-"," -"," ",c.time?.end||"-"]}),e.jsxs("p",{className:"text-gray-600",children:[e.jsx("strong",{children:"Mode:"})," ",c.mode||"-"]}),e.jsxs("p",{className:"text-gray-600",children:[e.jsx("strong",{children:"Days:"})," ",c.days?.length>0?c.days.join(", "):"-"]})]}),e.jsx("div",{children:e.jsxs("p",{className:"text-gray-600",children:[e.jsxs("strong",{children:[h,":"]})," ",c.coursesAssigned?.map(t=>t?.title).join(", ")||"-"]})}),e.jsx("div",{children:e.jsxs("p",{className:"text-gray-600",children:[e.jsx("strong",{children:"Notes:"})," ",c.additionalNotes||"No notes available"]})})]}):e.jsx("p",{className:"text-gray-500 italic",children:"Loading batch details..."})})]})};export{U as default};
