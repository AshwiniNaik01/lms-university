import{u as E,a as k,r as n,j as e,a1 as p}from"./index-BlaCQYdb.js";const R=()=>{const{token:i}=E(),b=k(),[d,f]=n.useState(""),[m,C]=n.useState(60),[y,w]=n.useState([]),[N,S]=n.useState([]),[h,A]=n.useState(""),[l,T]=n.useState(""),[o,c]=n.useState([{questionText:"",options:["","","",""],correctAnswer:""}]),[x,j]=n.useState(!1),[g,u]=n.useState("");n.useEffect(()=>{i&&(async()=>{try{const[r,s]=await Promise.all([p.get("/api/courses/all",{headers:{Authorization:`Bearer ${i}`}}),p.get("/api/branches",{headers:{Authorization:`Bearer ${i}`}})]);w(r.data.data||[]),S(s.data.data||[])}catch(r){u("Failed to load courses and branches. Please try again."),console.error(r)}})()},[i]);const Q=async t=>{if(t.preventDefault(),!d||!h||!l||o.some(s=>!s.questionText||!s.correctAnswer)){u("Please fill all required fields, including all question and answer fields.");return}j(!0),u("");const r={title:d,duration:m,course:h,branch:l,questions:o};try{await p.post("/api/tests",r,{headers:{Authorization:`Bearer ${i}`}}),b("/tests")}catch(s){u(s.response?.data?.message||"Failed to create test."),console.error("Error creating test:",s)}finally{j(!1)}},v=(t,r)=>{const s=[...o];s[t][r.target.name]=r.target.value,c(s)},q=(t,r,s)=>{const a=[...o];a[t].options[r]=s.target.value,c(a)},B=()=>{c([...o,{questionText:"",options:["","","",""],correctAnswer:""}])},D=t=>{const r=o.filter((s,a)=>a!==t);c(r)};return e.jsxs("div",{className:"create-test-container",children:[e.jsx("h2",{children:"Create a New Test"}),e.jsxs("form",{onSubmit:Q,children:[g&&e.jsx("p",{className:"error-message",style:{color:"red"},children:g}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Test Title"}),e.jsx("input",{type:"text",value:d,onChange:t=>f(t.target.value),required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Branch"}),e.jsxs("select",{value:l,onChange:t=>T(t.target.value),required:!0,children:[e.jsx("option",{value:"",children:"Select Branch"}),N.map(t=>e.jsx("option",{value:t._id,children:t.name},t._id))]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Course"}),e.jsxs("select",{value:h,onChange:t=>A(t.target.value),required:!0,disabled:!l,children:[e.jsx("option",{value:"",children:"Select Course"}),y.filter(t=>t.branch?._id===l).map(t=>e.jsx("option",{value:t._id,children:t.title},t._id))]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Duration (in minutes)"}),e.jsx("input",{type:"number",value:m,onChange:t=>C(parseInt(t.target.value,10)),required:!0})]}),e.jsx("hr",{}),e.jsx("h3",{children:"Questions"}),o.map((t,r)=>e.jsxs("div",{className:"question-block",children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("h4",{children:["Question ",r+1]}),o.length>1&&e.jsx("button",{type:"button",onClick:()=>D(r),className:"btn-remove",children:"Remove"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Question Text"}),e.jsx("input",{type:"text",name:"questionText",value:t.questionText,onChange:s=>v(r,s),required:!0})]}),t.options.map((s,a)=>e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{children:["Option ",a+1]}),e.jsx("input",{type:"text",value:s,onChange:_=>q(r,a,_),required:!0})]},a)),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Correct Answer (Select the correct option)"}),e.jsxs("select",{name:"correctAnswer",value:t.correctAnswer,onChange:s=>v(r,s),required:!0,children:[e.jsx("option",{value:"",children:"Select Correct Answer"}),t.options.filter(s=>s).map((s,a)=>e.jsx("option",{value:s,children:s},a))]})]})]},r)),e.jsx("button",{type:"button",onClick:B,className:"btn-secondary",children:"Add Another Question"}),e.jsx("button",{type:"submit",className:"btn-primary",disabled:x,children:x?"Creating...":"Create Test"})]})]})};export{R as default};
