import{b as A,a as $,r as l,q as I,al as B,c as R,j as s,aE as D,I as P,D as v,C as x,f as U,p as V,T as _,v as k,S as b,w as M,a1 as y}from"./index-BlaCQYdb.js";import{u as O,c as T,f as z}from"./notes-DU565Ure.js";import{u as L}from"./useCourseParam-Cp9FvxYK.js";function K(){const{noteId:o}=A(),N=$(),[c,j]=l.useState([]),[C,u]=l.useState([]),[w,f]=l.useState(""),[q,m]=l.useState([]),[h,g]=l.useState(!1),[p,S]=l.useState(null),[d,,F]=L(c),{rolePermissions:E}=I(r=>r.permissions);l.useEffect(()=>{(async()=>{try{const a=await k();j(a)}catch(a){console.error(`Failed to load ${x}:`,a)}})()},[]),l.useEffect(()=>{d&&c.length>0&&(f(d),t.setFieldValue("course",d))},[d,c]);const t=B({initialValues:{course:"",chapter:"",title:"",content:"",type:"",file:null,batches:""},validationSchema:R({}),onSubmit:async(r,{resetForm:a})=>{try{const e=new FormData;Object.entries(r).forEach(([i,n])=>{n&&(i==="batches"?e.append("batches",n):e.append(i,n))}),o?(await O(o,e),b.fire("Success","Note updated successfully!","success")):(await T(e),b.fire("Success","Note created successfully!","success")),a(),M(E,"note","read")&&N("/manage-notes")}catch(e){console.error(e),b.fire("Error",e.response?.data?.message||e.message||"Failed to submit note","error")}}});return l.useEffect(()=>{(async()=>{const a=t.values.course;if(!a){m([]);return}try{const e=await y.get(`/api/chapters/course/${a}`);m(e.data?.data||[])}catch(e){console.error(`Failed to load chapters for ${x}:`,e),m([])}})()},[t.values.course]),l.useEffect(()=>{(async()=>{const a=t.values.course;if(!a){u([]);return}try{const e=await y.get(`/api/batches/course/${a}`);u(e.data?.data||[])}catch(e){console.error("Failed to load batches:",e),u([])}})()},[t.values.course]),l.useEffect(()=>{if(!o||c.length===0)return;(async()=>{g(!0);try{const a=await z(o),e=a?.data||a;if(!e)return;const i=e.course||e.chapter?.courseDetails?._id||"",n=e.batches?.[0]||"";f(i),t.setValues({course:i,batches:n,title:e.title||"",content:e.content||"",type:e.type||"",file:null}),e.file&&S(e.file)}catch(a){console.error(a)}finally{g(!1)}})()},[o,c]),h?s.jsx("p",{className:"text-center mt-10 text-blue-700 font-medium",children:"Loading note details..."}):s.jsx(D,{value:t,children:s.jsxs("form",{onSubmit:t.handleSubmit,className:"p-10 bg-white rounded-lg shadow-2xl max-w-5xl mx-auto space-y-6 overflow-hidden border-4 border-[rgba(14,85,200,0.83)]",children:[s.jsx("h2",{className:"text-4xl font-bold text-[rgba(14,85,200,0.83)] text-center",children:o?"Edit Reference Material":"Add Reference Material"}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[s.jsx(P,{label:"Title*",name:"title",formik:t}),s.jsx(v,{label:`${x}*`,name:"course",options:c,formik:t,value:w,onChange:r=>{const a=r.target.value;f(a),t.setFieldValue("course",a)},disabled:F}),s.jsx(v,{label:"Batch*",name:"batches",options:C.map(r=>({_id:r._id,title:`${r.batchName} (${r.mode} - ${r.status})`})),formik:t,onChange:r=>{t.setFieldValue("batches",r)}}),s.jsxs("div",{className:"md:col-span-2 mb-6",children:[s.jsx("label",{className:"block text-sm font-semibold text-gray-800 mb-2",children:"Upload File*"}),s.jsxs("div",{className:"relative w-full",children:[s.jsx("input",{type:"file",name:"file",onChange:r=>{const a=r.target.files[0];a&&t.setFieldValue("file",a)},className:"absolute inset-0 opacity-0 cursor-pointer z-20"}),s.jsxs("div",{className:"flex items-center justify-between border-2 border-dashed border-gray-300 bg-white px-4 py-3 rounded-lg shadow-sm hover:border-blue-400 transition-all duration-300 z-10",children:[s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx(U,{className:"text-blue-600"}),s.jsx("span",{className:"text-gray-700 font-medium truncate max-w-[300px]",children:t.values.file?t.values.file.name:"Choose a file..."})]}),s.jsx("span",{className:"text-sm text-gray-500 hidden md:block",children:"All file types allowed"})]})]}),p&&!t.values.file&&s.jsxs("p",{className:"mt-2 text-sm text-blue-700",children:["Existing file:"," ",s.jsx("a",{href:`${V.COURSE_NOTES}${p}`,target:"_blank",rel:"noopener noreferrer",className:"underline font-medium",children:p})]}),t.touched.file&&t.errors.file&&s.jsx("div",{className:"text-red-500 text-sm font-medium mt-1",children:t.errors.file})]}),s.jsx("div",{className:"md:col-span-2",children:s.jsx(_,{label:"Description (optional)",name:"content",formik:t,rows:4})})]}),s.jsx("div",{className:"text-center",children:s.jsx("button",{type:"submit",disabled:t.isSubmitting||h,className:"bg-blue-600 text-white font-semibold px-8 py-3 rounded-xl shadow-lg hover:bg-blue-700 transition duration-300 disabled:opacity-50",children:t.isSubmitting||h?o?"Updating...":"Creating...":o?"Update Reference Material":"Add Reference Material"})})]})})}export{K as default};
