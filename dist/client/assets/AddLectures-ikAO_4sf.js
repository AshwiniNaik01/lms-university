import{r as o,j as s,bS as T,b as R,a as A,q as $,al as V,c as D,d as P,C as S,aE as _,I as N,D as L,T as B,a1 as U,S as x,v as M,a6 as I,p as O,a5 as q}from"./index-BlaCQYdb.js";import{g as Y}from"./chapters-Dib9kOSx.js";import{f as k}from"./trainerApi-C8uD07iT.js";import{M as z}from"./MultiSelectDropdown-C1q29ZzD.js";import{u as W}from"./useCourseParam-Cp9FvxYK.js";const G=({label:i,name:c,formik:d})=>{const[h,m]=o.useState(null),l=d.values[c];o.useEffect(()=>{if(l instanceof File){const u=URL.createObjectURL(l);return m(u),()=>URL.revokeObjectURL(u)}else m(typeof l=="string"?l:null)},[l]);const f=u=>{const b=u.currentTarget.files[0];b&&b.type==="video/mp4"?d.setFieldValue(c,b):(d.setFieldValue(c,null),alert("Please upload a valid MP4 file."))},g=d.touched[c]&&d.errors[c];return s.jsxs("div",{className:"w-full space-y-2",children:[i&&s.jsx("label",{htmlFor:c,className:"block text-sm font-medium text-gray-700",children:i}),s.jsxs("div",{className:"relative w-full",children:[s.jsx("input",{type:"file",name:c,id:c,accept:"video/mp4",onChange:f,className:"absolute inset-0 opacity-0 cursor-pointer z-20"}),s.jsxs("div",{className:`flex items-center justify-between border-2 border-dashed ${g?"border-red-400":"border-gray-300 hover:border-blue-400"} bg-white px-4 py-3 rounded-lg shadow-sm transition-all duration-300`,children:[s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx(T,{className:"text-blue-600 text-xl"}),s.jsx("span",{className:"text-gray-700 font-medium truncate max-w-[300px]",children:l?l.name:"Choose a video file (.mp4)"})]}),s.jsx("span",{className:"text-sm text-gray-500 hidden md:block",children:"Max: 100MB"})]})]}),h&&s.jsx("div",{className:"mt-3",children:s.jsx("video",{src:h,controls:!0,className:"w-72 h-44 object-cover rounded-lg border border-gray-300 shadow-md"})}),g&&s.jsx("div",{className:"text-red-500 text-xs font-medium",children:d.errors[c]})]})};function Z(){const{lectureId:i}=R(),c=A(),{rolePermissions:d}=$(t=>t.permissions),[h,m]=o.useState([]),[l,f]=o.useState([]),[g,u]=o.useState([]),[b,j]=o.useState([]),[v,E]=o.useState(!1),[y,w]=o.useState(""),[p,,F]=W(h),a=V({initialValues:{course:"",chapter:"",title:"",description:"",contentUrl:null,duration:"",type:"",trainer:[],batches:[],status:"pending"},validationSchema:D({course:P().required(`${S} is required`)}),onSubmit:async(t,{resetForm:r})=>{try{const e=new FormData;e.append("course",t.course),e.append("chapter",t.chapter),e.append("title",t.title),e.append("description",t.description),e.append("duration",t.duration),e.append("type",t.type),t.trainer.forEach(n=>e.append("trainer[]",n)),e.append("status",t.status),t.batches.forEach(n=>e.append("batches[]",n)),t.contentUrl&&e.append("contentUrl",t.contentUrl),i?(await U.put(`/api/lectures/${i}`,e,{headers:{"Content-Type":"multipart/form-data"}}),x.fire("Success","Lecture updated successfully!","success").then(()=>{r(),c("/manage-course-videos")})):(await U.post("/api/lectures",e,{headers:{"Content-Type":"multipart/form-data"}}),x.fire("Success","Lecture created successfully!","success").then(()=>{r(),c("/manage-course-videos")}))}catch(e){console.error(e),x.fire("Error",e.response?.data?.message||e.message,"error")}}});return o.useEffect(()=>{(async()=>{try{const r=await M();m(r||[]);const e=await k();u(e||[]),p&&w(p)}catch(r){console.error("Error fetching dropdown data:",r)}})()},[p]),o.useEffect(()=>{p&&a.setFieldValue("course",p)},[p]),o.useEffect(()=>{(async r=>{if(!r){f([]);return}try{const e=await Y(r);f(e.success?e.data||[]:[])}catch(e){console.error("Error fetching chapters:",e),f([])}})(y||a.values.course)},[y,a.values.course]),o.useEffect(()=>{(async()=>{const r=y||a.values.course;if(!r){j([]);return}try{const e=await I(r);j(e)}catch(e){console.error("Error fetching batches:",e),j([])}})()},[y,a.values.course]),o.useEffect(()=>{if(!i)return;(async()=>{E(!0);try{const r=await U.get(`/api/lectures/${i}`);if(r.data.success&&r.data.data){const e=r.data.data;let n=null;e.type==="mp4"&&e.contentUrl?n=O.LECTURE_CONTENT+e.contentUrl:e.type==="youtube"&&(n=e.contentUrl),a.setValues({course:e.course?._id||"",chapter:e.chapter?._id||"",title:e.title||"",description:e.description||"",duration:e.duration||"",type:e.type||"",trainer:e.trainer?.map(C=>C._id)||[],batches:e.batches?.map(C=>C._id)||[],status:e.status||"pending",contentUrl:n}),w(e.course?._id||"")}else x.fire("Error","Lecture not found","error"),c("/manage-course-videos")}catch(r){console.error(r),x.fire("Error",q(r)||"Failed to fetch lecture","error"),c("/manage-course-videos")}finally{E(!1)}})()},[i]),v?s.jsx("p",{className:"text-center mt-10",children:"Loading lecture..."}):s.jsx(_,{value:a,children:s.jsxs("form",{onSubmit:a.handleSubmit,className:"p-10 bg-white rounded-lg shadow-2xl max-w-5xl mx-auto space-y-8 border-4 border-[rgba(14,85,200,0.83)]",children:[s.jsx("h2",{className:"text-4xl font-bold text-[rgba(14,85,200,0.83)] text-center",children:i?"Edit Recording":"Add Recording"}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[s.jsx(N,{label:"Title*",name:"title",type:"text",formik:a}),s.jsx(L,{label:`${S}*`,name:"course",options:h,formik:a,onChange:t=>{a.setFieldValue("course",t),a.setFieldValue("chapter",""),w(t)},disabled:F}),s.jsx(z,{label:"Batch*",name:"batches",formik:a,options:b,getOptionValue:t=>t._id,getOptionLabel:t=>{const r={monday:"Mon",tuesday:"Tue",wednesday:"Wed",thursday:"Thu",friday:"Fri",saturday:"Sat",sunday:"Sun"},e=t.days.map(n=>r[n.toLowerCase()]||n).join(", ");return`${t.batchName} | ${t.time.start} - ${t.time.end} | ${e} | ${t.mode}`}}),s.jsx(L,{label:"Type*",name:"type",options:[{_id:"mp4",name:"MP4"},{_id:"youtube",name:"YouTube URL"}],formik:a}),a.values.type==="mp4"&&s.jsx(G,{label:"Lecture Video (.mp4)",name:"contentUrl",formik:a}),a.values.type==="youtube"&&s.jsx(N,{label:"YouTube URL",name:"contentUrl",type:"url",formik:a})]}),s.jsx(B,{label:"Description (optional)",name:"description",rows:4,formik:a}),s.jsx("div",{className:"text-center pt-4",children:s.jsx("button",{type:"submit",disabled:a.isSubmitting||v,className:"bg-[rgba(14,85,200,0.83)] text-white font-semibold px-10 py-3 rounded-xl shadow-lg hover:bg-blue-700 transition duration-300 disabled:opacity-50",children:a.isSubmitting||v?i?"Updating...":"Adding...":i?"Update Recording":"Add Recording"})})]})})}export{Z as default};
