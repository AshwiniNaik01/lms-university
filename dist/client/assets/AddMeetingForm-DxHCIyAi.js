import{r,al as D,a1 as n,j as a,aE as w,I as i,D as d,C as T,v as E,S as b}from"./index-BlaCQYdb.js";const O=()=>{const[u,m]=r.useState(!1),[x,p]=r.useState([]),[j,o]=r.useState([]),[f,c]=r.useState(""),[v,y]=r.useState([]),t=D({initialValues:{title:"",description:"",meetingDescription:"",platform:"Google Meet",meetingLink:"",meetingId:"",meetingPassword:"",batch:"",trainer:"",course:"",startDate:"",endDate:"",startTime:"",endTime:"",notification:""},onSubmit:async e=>{m(!0);const s={...e};e.platform==="Other"&&(s.platform=f);try{const l=await n.post("/api/meetings",s);l.data.success&&(b.fire({icon:"success",title:"Success",text:l.data.message||"Session created successfully!",confirmButtonText:"OK"}),t.resetForm(),c(""))}catch(l){console.error("Error creating session:",l),b.fire({icon:"error",title:"Error",text:l.response?.data?.message||"Failed to create session.",confirmButtonText:"OK"})}finally{m(!1)}}});r.useEffect(()=>{(async()=>{try{const s=await E();p(s)}catch(s){console.error("Error fetching courses:",s)}})()},[]),r.useEffect(()=>{n.get("/api/trainer/all").then(e=>{e.data.success&&y(e.data.data)}).catch(e=>{console.error("Error fetching trainers:",e)})},[]),r.useEffect(()=>{if(!t.values.course){o([]),t.setFieldValue("batch","");return}n.get(`/api/batches/course/${t.values.course}`).then(e=>{e.data.success&&e.data.data.length>0?o(e.data.data):(o([]),t.setFieldValue("batch",""))}).catch(e=>{o([]),t.setFieldValue("batch",""),console.error("Error fetching batches:",e)})},[t.values.course]),r.useEffect(()=>{t.values.batch&&n.get(`/api/batches/batches/${t.values.batch}`).then(e=>{if(e.data.success&&e.data.data){const s=e.data.data;s.trainer&&s.trainer.length>0&&t.setFieldValue("trainer",s.trainer[0]._id),s.startDate&&t.setFieldValue("startDate",s.startDate),s.endDate&&t.setFieldValue("endDate",s.endDate),s.time?.start&&t.setFieldValue("startTime",s.time.start),s.time?.end&&t.setFieldValue("endTime",s.time.end)}}).catch(e=>console.error("Error fetching batch details:",e))},[t.values.batch]);const h=((e,s)=>{if(!e||!s)return 0;const l=new Date(e),g=new Date(s);if(g<l)return 0;const S=g.getTime()-l.getTime();return Math.floor(S/(1e3*60*60*24))+1})(t.values.startDate,t.values.endDate);return a.jsx(w,{value:t,children:a.jsxs("form",{onSubmit:t.handleSubmit,className:"p-10 bg-white rounded-xl shadow-2xl max-w-5xl mx-auto space-y-6 overflow-hidden border-4 border-[rgba(14,85,200,0.83)]",children:[a.jsx("h2",{className:"text-3xl font-bold text-[rgba(14,85,200,0.83)] text-center mb-6",children:"Add Session"}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[a.jsx(i,{label:"Title*",name:"title",formik:t}),a.jsxs("div",{className:"space-y-1",children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Platform*"}),a.jsxs("select",{value:["Zoom","Google Meet","Teams"].includes(t.values.platform)?t.values.platform:"Other",onChange:e=>{const s=e.target.value;t.setFieldValue("platform",s),s!=="Other"&&c("")},className:"w-full px-4 py-2 rounded-lg border border-blue-100 focus:outline-none focus:ring-2 focus:ring-blue-300",children:[a.jsx("option",{value:"",children:"Select Platform"}),a.jsx("option",{value:"Zoom",children:"Zoom"}),a.jsx("option",{value:"Google Meet",children:"Google Meet"}),a.jsx("option",{value:"Teams",children:"Teams"}),a.jsx("option",{value:"Other",children:"Other"})]}),t.values.platform==="Other"&&a.jsx("input",{type:"text",placeholder:"Enter custom platform",value:f,onChange:e=>c(e.target.value),className:"w-full px-4 py-2 rounded-lg border border-blue-100 mt-2 focus:outline-none focus:ring-2 focus:ring-blue-300"})]}),a.jsx(i,{label:"Session Link*",name:"meetingLink",type:"url",formik:t}),a.jsx(i,{label:"Session ID*",name:"meetingId",formik:t}),a.jsx(i,{label:"Session Password*",name:"meetingPassword",formik:t}),a.jsx(d,{label:`${T}*`,name:"course",formik:t,options:x.map(e=>({_id:e._id,title:e.title}))}),a.jsx(d,{label:"Batch*",name:"batch",formik:t,options:j.map(e=>({_id:e._id,name:e.batchName}))}),a.jsx(d,{label:"Trainer*",name:"trainer",formik:t,options:v.map(e=>({_id:e._id,title:e.fullName}))}),a.jsx(i,{label:"Start Date*",name:"startDate",type:"date",formik:t}),a.jsx(i,{label:"End Date*",name:"endDate",type:"date",formik:t}),a.jsx(i,{label:"Start Time*",name:"startTime",type:"time",formik:t}),a.jsx(i,{label:"End Time*",name:"endTime",type:"time",formik:t}),a.jsxs("div",{className:"space-y-1",children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Meeting Occurrence"}),a.jsx("input",{type:"text",value:h>0?`${h} meetings`:"Select start & end date",disabled:!0,className:"w-full px-4 py-2 rounded-lg border border-gray-200 bg-gray-100 text-gray-700 cursor-not-allowed"})]}),a.jsx(i,{label:"Notification (optional)",name:"notification",formik:t,type:"textarea"})]}),a.jsx("div",{className:"text-center",children:a.jsx("button",{type:"submit",disabled:u,className:"bg-blue-600 text-white font-semibold px-8 py-3 rounded-xl shadow-lg hover:bg-blue-700 transition duration-300",children:u?"Adding...":"Add Session"})})]})})};export{O as default};
