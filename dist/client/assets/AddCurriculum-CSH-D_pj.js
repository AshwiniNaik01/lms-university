import{aH as K,r as i,q as Q,a8 as Y,al as T,ca as z,c as D,j as e,C as w,cb as B,I as v,T as W,aE as O,h as J,a1 as m}from"./index-BlaCQYdb.js";function ee(){const[N]=K(),n=N.get("courseId"),c=N.get("phaseId"),g=N.get("weekId"),[M,h]=i.useState(1),A=Q(s=>s.curriculum.selectedCourseId),[L,U]=i.useState([]),[F,V]=i.useState(""),[k,S]=i.useState([]),[q,I]=i.useState([]),y=Y(),[x,p]=i.useState(!1),[$,E]=i.useState(null),[_,C]=i.useState({show:!1,type:"",data:null}),P=N.get("type"),b=s=>{if(!s.response||!s.response.data)return s.message||"Please Try Again!";const t=s.response.data;return t.success||t.message||t.error||"Please Try Again!"},d=(s,t="success")=>{E({message:s,type:t}),setTimeout(()=>E(null),3e3)};i.useEffect(()=>{n?console.log("Adding Schedules for Training ID:",n):c?console.log("Adding Module for Schedule ID:",c):g&&console.log("Adding Course Content for Module ID:",g)},[n,c,g]),i.useEffect(()=>{h(P==="phase"?1:P==="week"?2:P==="chapter"||g?3:c?2:1)},[P,n,c,g]),i.useEffect(()=>{(async()=>{try{const t=await m.get("/api/courses/all");U(t.data?.data||[])}catch(t){d("âŒ "+b(t),"error")}})()},[]),i.useEffect(()=>{(async()=>{if(c){p(!0);try{const t=await m.get(`/api/phases/${c}`),l=t.data?.data||t.data;l?._id&&(S([l]),V(l._id),r.setFieldValue("phase",l._id))}catch(t){console.error("Error fetching phase details:",t),d("âŒ "+b(t),"error")}finally{p(!1)}}})()},[c]),i.useEffect(()=>{if(!n)return;(async()=>{p(!0);try{const t=await m.get(`/api/phases/course/${n}`);S(t.data?.data||[])}catch(t){t.response?.status===404?S([]):d("âŒ "+b(t),"error")}try{const t=await m.get(`/api/weeks/course/${n}`);I(t.data?.data||[])}catch(t){console.log(b(t))}finally{p(!1)}})()},[n]),i.useEffect(()=>{if(c&&k.length>0){const s=k.find(t=>t._id===c);s&&(V(s._id),r.setFieldValue("phase",s._id))}},[c,k]),i.useEffect(()=>()=>{y(z())},[y]),i.useEffect(()=>{r.setFieldValue("phase",F||"")},[F]);const u=T({enableReinitialize:!0,initialValues:{course:n||A||"",title:"",description:""},validationSchema:D({}),onSubmit:async(s,{resetForm:t})=>{if(!s.course){d(`Please select a ${w} first`,"error");return}p(!0);try{const a=(await m.post("/api/phases",[s])).data?.data[0];d("ðŸŽ‰ Schedule created successfully!","success"),t(),y(B(a.course));const j=await m.get(`/api/phases/course/${a.course}`);S(j.data?.data||[]),C({show:!0,type:"phase",data:a})}catch(l){d("âŒ "+b(l),"error")}finally{p(!1)}}}),r=T({enableReinitialize:!0,initialValues:{course:n||A||"",phase:c||F||"",weeks:[{weekNumber:1,title:""}]},validationSchema:D({}),onSubmit:async(s,{resetForm:t})=>{if(!s.course||!s.phase){d(`Please select a ${w} and phase first`,"error");return}p(!0);try{const l=s.weeks.map(f=>({...f,course:s.course,phase:s.phase})),j=(await Promise.all(l.map(f=>m.post("/api/weeks",[f])))).map(f=>f.data?.data[0]||f.data||f);d("ðŸŽ‰ Module created successfully!","success"),t();const R=await m.get(`/api/weeks/course/${s.course}`);I(R.data?.data||[]),C({show:!0,type:"weeks",data:j})}catch(l){d("âŒ "+b(l),"error")}finally{p(!1)}}}),o=T({enableReinitialize:!0,initialValues:{course:n||A||"",week:g||"",title:"",points:[{title:"",description:""}]},validationSchema:D({}),onSubmit:async(s,{resetForm:t})=>{if(!s.course||!s.week){d(`Please select a ${w} and module first`,"error");return}p(!0);try{const l={...s,course:s.course,week:s.week},a=await m.post("/api/chapters",[l]),j=a.data?.data[0]||a.data||a;d("ðŸŽ‰ Course Content created successfully!","success"),t(),y(B(s.course));const R=await m.get(`/api/weeks/course/${s.course}`);I(R.data?.data||[]),C({show:!0,type:"chapter",data:j})}catch(l){d("âŒ "+b(l),"error")}finally{p(!1)}}}),H=s=>{switch(_.type){case"phase":s==="addMore"?u.resetForm():s==="proceed"&&h(2);break;case"weeks":s==="addMore"?r.resetForm():s==="proceed"&&h(3);break;case"chapter":s==="addMore"?o.resetForm():s==="done"&&(h(1),u.resetForm(),r.resetForm(),o.resetForm(),y(z()));break}C({show:!1,type:"",data:null})},X=()=>{if(!_.show)return null;const t=(()=>{switch(_.type){case"phase":return{title:"Schedule Created Successfully! ðŸŽ‰",buttons:[{label:"Add More Schedules",action:"addMore",variant:"secondary"},{label:"Proceed to Modules",action:"proceed",variant:"primary"}]};case"weeks":return{title:"Module Created Successfully!",buttons:[{label:"Add More Module",action:"addMore",variant:"secondary"},{label:"Proceed to Course Contents",action:"proceed",variant:"primary"}]};case"chapter":return{title:"Course Content Created Successfully! ðŸ“š",buttons:[{label:"Add New Course Content",action:"addMore",variant:"secondary"},{label:"Done",action:"done",variant:"primary"}]};default:return{title:"",message:"",buttons:[]}}})();return e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"relative bg-white rounded-2xl shadow-2xl p-8 max-w-md w-full animate-scale-in",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("div",{className:"w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx("span",{className:"text-3xl",children:"âœ…"})}),e.jsx("h3",{className:"text-2xl font-bold text-gray-800 mb-2",children:t.title}),e.jsx("p",{className:"text-gray-600",children:t.message})]}),e.jsx("div",{className:"flex flex-col gap-3",children:t.buttons.map((l,a)=>e.jsx("button",{onClick:()=>H(l.action),className:`w-full py-3 px-6 rounded-xl font-semibold transition-all duration-300 ${l.variant==="primary"?"bg-gradient-to-r from-blue-500 to-purple-500 text-white hover:shadow-lg":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:l.label},a))})]})})},G=({message:s,type:t,onClose:l})=>e.jsxs("div",{className:`fixed top-6 right-6 px-6 py-3 rounded-xl shadow-2xl text-white font-semibold z-50 flex items-center gap-3 animate-slide-in ${t==="success"?"bg-green-500":"bg-red-500"}`,children:[e.jsx("span",{children:s}),e.jsx("button",{onClick:l,className:"text-white hover:text-gray-200 font-bold",children:"âœ•"})]});return e.jsx("div",{className:"max-h-fit bg-gradient-to-br from-blue-50 via-white to-purple-50 py-2",children:e.jsxs("div",{className:"max-w-7xl mx-auto p-4",children:[e.jsxs("div",{className:"text-start mb-8",children:[e.jsx("h1",{className:"text-2xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent mb-4",children:"ðŸŽ¯ Curriculum Builder"}),e.jsx("hr",{})]}),x&&e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-2xl p-8 text-center shadow-2xl",children:[e.jsx("div",{className:"w-16 h-16 border-4 border-blue-500 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-gray-700 font-semibold",children:"Processing..."})]})}),M===1&&e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-4",children:[e.jsxs("h2",{className:"text-xl font-bold text-gray-800 mb-6 flex items-center gap-3",children:[e.jsx("span",{className:"text-2xl",children:"ðŸ—ï¸"}),"Create New Schedule"]}),e.jsxs("form",{onSubmit:u.handleSubmit,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:["Select ",w,"*"]}),e.jsxs("select",{name:"course",value:u.values.course,onChange:s=>{const t=s.target.value;u.setFieldValue("course",t),y(B(t))},onBlur:u.handleBlur,className:"w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-all",children:[e.jsxs("option",{value:"",children:["Choose a ",w]}),L.map(s=>e.jsx("option",{value:s._id,children:s.title},s._id))]}),u.touched.course&&u.errors.course&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:u.errors.course})]}),e.jsx(v,{label:"Schedule Name*",name:"title",formik:u}),e.jsx(W,{label:"Description (optional)",name:"description",formik:u,rows:4}),e.jsx("div",{className:"flex gap-4 pt-4 w-50 justify-end",children:e.jsx("button",{type:"submit",disabled:x,className:"flex-1 bg-gradient-to-r from-blue-500 to-purple-500 text-white py-4 rounded-xl font-bold hover:shadow-xl transition-all duration-300 disabled:opacity-50",children:x?"Saving...":"ðŸš€ Save Schedule"})})]})]}),M===2&&e.jsx(O,{value:r,children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg p-8",children:[e.jsxs("h2",{className:"text-2xl font-bold text-gray-800 mb-6 flex items-center gap-3",children:[e.jsx("span",{className:"text-3xl",children:"ðŸ“…"}),"Add Module for Schedules"]}),e.jsxs("form",{onSubmit:r.handleSubmit,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Select Schedule*"}),e.jsxs("select",{name:"phase",value:r.values.phase,onChange:r.handleChange,onBlur:r.handleBlur,className:"w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-all",children:[e.jsx("option",{value:"",children:"Select Schedule"}),k.map(s=>e.jsx("option",{value:s._id,children:s.title},s._id))]}),r.touched.phase&&r.errors.phase&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:r.errors.phase})]}),e.jsx(J,{name:"weeks",children:({push:s,remove:t})=>e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700",children:"Module Details"}),e.jsx("button",{type:"button",onClick:()=>s({weekNumber:r.values.weeks.length+1,title:""}),className:"bg-green-500 text-white px-4 py-2 rounded-lg hover:bg-green-600 transition-all",children:"âž• Add Modules"})]}),r.values.weeks.map((l,a)=>e.jsxs("div",{className:"border-2 border-gray-200 rounded-xl p-4 bg-gray-50",children:[e.jsxs("div",{className:"flex gap-4 items-start",children:[e.jsx("div",{className:"w-28",children:e.jsx(v,{label:"Module Number*",name:`weeks.${a}.weekNumber`,type:"number",formik:r})}),e.jsx("div",{className:"flex-1",children:e.jsx(v,{label:"Module Title*",name:`weeks.${a}.title`,formik:r,placeholder:"e.g., JavaScript Fundamentals"})}),e.jsx("button",{type:"button",onClick:()=>t(a),disabled:r.values.weeks.length===1,className:"text-red-500 hover:text-red-700 disabled:text-gray-400 mt-6",children:"ðŸ—‘ï¸"})]}),r.errors.weeks?.[a]&&e.jsx("p",{className:"text-red-500 text-sm mt-2",children:Object.values(r.errors.weeks[a]).join(", ")})]},a))]})}),e.jsx("div",{className:"flex gap-4 pt-4 w-50",children:e.jsx("button",{type:"submit",disabled:x,className:"flex-1 bg-gradient-to-r from-blue-500 to-purple-500 text-white py-4 rounded-xl font-bold hover:shadow-xl transition-all duration-300 disabled:opacity-50",children:x?"Saving...":"ðŸš€ Save Modules"})})]})]})}),M===3&&e.jsx(O,{value:o,children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg p-8",children:[e.jsxs("h2",{className:"text-2xl font-bold text-gray-800 mb-6 flex items-center gap-3",children:[e.jsx("span",{className:"text-3xl",children:"ðŸ“š"}),"Build Course Content"]}),e.jsxs("form",{onSubmit:o.handleSubmit,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Select Module*"}),e.jsxs("select",{name:"week",value:o.values.week,onChange:o.handleChange,onBlur:o.handleBlur,className:"w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-all",children:[e.jsx("option",{value:"",children:"Choose a Module"}),q.map(s=>e.jsxs("option",{value:s._id,children:["Module ",s.weekNumber,": ",s.title]},s._id))]}),o.touched.week&&o.errors.week&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:o.errors.week})]}),e.jsx(v,{label:"Course Content Title*",name:"title",formik:o,placeholder:"e.g., Introduction to React Components"}),e.jsx(J,{name:"points",children:({push:s,remove:t})=>e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700",children:"Learning Points"}),e.jsx("button",{type:"button",onClick:()=>s({title:"",description:""}),className:"bg-green-500 text-white px-4 py-2 rounded-lg hover:bg-green-600 transition-all",children:"âž• Add Point"})]}),o.values.points.map((l,a)=>e.jsxs("div",{className:"border-2 border-gray-200 rounded-xl p-4 bg-gray-50",children:[e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"flex-1 space-y-3",children:[e.jsx(v,{label:"Point Title (optional)",name:`points.${a}.title`,formik:o,placeholder:"e.g., Understanding JSX"}),e.jsx(W,{label:"Description (optional)",name:`points.${a}.description`,formik:o,rows:4})]}),e.jsx("button",{type:"button",onClick:()=>t(a),disabled:o.values.points.length===1,className:"text-red-500 hover:text-red-700 disabled:text-gray-400",children:"ðŸ—‘ï¸"})]}),o.errors.points?.[a]&&e.jsx("p",{className:"text-red-500 text-sm mt-2",children:Object.values(o.errors.points[a]).join(", ")})]},a))]})}),e.jsx("div",{className:"flex gap-4 pt-4 w-50",children:e.jsx("button",{type:"submit",disabled:x,className:"flex-1 bg-gradient-to-r from-blue-500 to-purple-500 text-white py-4 rounded-xl font-bold hover:shadow-xl transition-all duration-300 disabled:opacity-50",children:x?"Saving...":"ðŸš€ Save Course Content"})})]})]})}),e.jsx(X,{}),$&&e.jsx(G,{message:$.message,type:$.type,onClose:()=>E(null)})]})})}export{ee as default};
