import{r as i,a as D,u as E,a8 as T,q as L,j as e,w as a,t as B,M as I,p as M,a1 as f,S as r}from"./index-BlaCQYdb.js";function _(){const[b,j]=i.useState([]),[g,x]=i.useState(!0),[l,u]=i.useState(null),[s,h]=i.useState(null),o=D();JSON.parse(localStorage.getItem("permissions"));const d=new URLSearchParams(window.location.search).get("b_id"),{currentUser:N}=E();N?.user?.role,T();const{rolePermissions:n,loading:y}=L(t=>t.permissions),p=async()=>{x(!0);try{const t=await f.get("/api/assignments");if(t.data.success){let m=t.data.data;d&&(m=t.data.data.filter(c=>c.batches?.includes(d))),j(m||[])}else u(t.data.message||"Failed to fetch assignments")}catch(t){u(t.response?.data?.message||t.message)}finally{x(!1)}};i.useEffect(()=>{p()},[]);const v=t=>{if(!a(n,"assignment","update")){r.fire({icon:"error",title:"Access Denied",text:"You do not have permission to update assignments."});return}o(`/edit-assignment/${t}`)},w=async t=>{if(!a(n,"assignment","delete")){r.fire({icon:"error",title:"Access Denied",text:"You do not have permission to delete assignments."});return}if((await r.fire({title:"Are you sure?",text:"This action cannot be undone!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Yes, delete it!",cancelButtonText:"Cancel"})).isConfirmed)try{await f.delete(`/api/assignments/${t}`),await r.fire({icon:"success",title:"Deleted!",text:"The assignment has been deleted successfully.",confirmButtonColor:"#0E55C8",timer:2e3}),p()}catch(c){console.error(c),r.fire({icon:"error",title:"Failed!",text:c.response?.data?.message||"Failed to delete assignment.",confirmButtonColor:"#0E55C8"})}},A=t=>h(t),C=()=>h(null);if(g||y)return e.jsx("p",{className:"text-center mt-10",children:"Loading..."});if(l)return e.jsx("p",{className:"text-center mt-10 text-red-500",children:l});const S=[{header:"Title",accessor:"title"},{header:"Deadline",accessor:t=>t.deadline?.split("T")[0]||"-"},{header:"Actions",accessor:t=>e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>A(t),className:"px-3 py-1 bg-indigo-500 text-white rounded hover:bg-indigo-600 transition",children:"View"}),a(n,"assignment","update")&&e.jsx("button",{onClick:()=>v(t._id),className:"px-3 py-1 bg-blue-500 text-white rounded hover:bg-blue-600 transition",children:"Edit"}),a(n,"assignment","create")&&e.jsx("button",{onClick:()=>o(`/evaluate-assignment?assignmentId=${t._id}&batchId=${d}`),className:"px-3 py-1 bg-emerald-500 text-white rounded hover:bg-emerald-600 transition",children:"Evaluate"}),a(n,"assignment","delete")&&e.jsx("button",{onClick:()=>w(t._id),className:"px-3 py-1 bg-red-500 text-white rounded hover:bg-red-600 transition",children:"Delete"})]})}];return g?e.jsx("p",{className:"text-center mt-10",children:"Loading assignments..."}):l?e.jsx("p",{className:"text-center mt-10 text-red-500",children:l}):e.jsx("div",{className:"p-8 max-h-screen bg-white font-sans",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-700",children:"Manage Assignments"}),a(n,"assignment","create")&&e.jsx("button",{onClick:()=>o("/add-assignment"),className:"px-4 py-2 bg-cyan-500 text-white rounded-lg hover:bg-cyan-600 transition",children:"+ Add Assignment"})]}),e.jsx(B,{columns:S,data:b,maxHeight:"550px",emptyMessage:"No assignments available."}),e.jsx(I,{isOpen:!!s,onClose:C,header:s?.title||"Assignment Details",children:s?e.jsxs("div",{className:"space-y-4 grid grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-500 uppercase",children:"Title"}),e.jsx("p",{className:"text-lg text-gray-800",children:s.title})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-500 uppercase",children:"Deadline"}),e.jsx("p",{className:"text-gray-800",children:s.deadline?new Date(s.deadline).toLocaleDateString():"No deadline"})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-500 uppercase",children:"Assignment File"}),s.fileUrl?e.jsx("a",{href:`${M.ASSIGNMENT_FILES}${s.fileUrl}`,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-2 mt-1 px-4 py-2 bg-indigo-500 text-white rounded-lg hover:bg-indigo-600 transition",children:"ðŸ“„ View Assignment File"}):e.jsx("p",{className:"text-gray-400 italic",children:"No file uploaded"})]})]}):e.jsx("p",{children:"Loading..."})})]})})}export{_ as default};
