import{a as G,aH as H,r as t,q,j as e,w as x,t as z,C as V,M as S,aG as B,x as k,a1 as E,aI as Y,S as r}from"./index-BlaCQYdb.js";import{u as J}from"./usePassword-DK4VtSSf.js";const Z=()=>{const c=G(),[R]=H(),n=R.get("b_id"),[_,P]=t.useState([]),[v,A]=t.useState(""),[M,C]=t.useState(!1),[I,i]=t.useState(!1),[L,T]=t.useState(!1),[o,K]=t.useState(null),[$,Q]=t.useState(null),{rolePermissions:d}=q(s=>s.permissions),[m,h]=t.useState(null),[f,p]=t.useState(""),[g,w]=t.useState(!1),[N,y]=t.useState(!1),{password:u,setPassword:b,generate:D}=J(""),F=async()=>{if(!u||!f){r.fire("Error","Password fields cannot be empty","error");return}if(u!==f){r.fire("Error","Passwords do not match","error");return}if(!m?.enrollmentId){r.fire("Error","No enrollment selected for password reset","error");return}try{await E.put(`/api/enrollments/${m.enrollmentId}`,{password:u}),r.fire("Success","Password reset successfully","success"),h(null),b(""),p(""),w(!1),y(!1)}catch(s){r.fire("Error",s.response?.data?.message||"Failed to reset password","error")}};t.useEffect(()=>{(async()=>{try{i(!0);let l=(await E.get("/api/enrollments")).data.data||[];n&&(l=l.filter(j=>j.enrollment?.enrolledBatches?.some(U=>U._id===n))),P(l)}catch(a){console.error("Error fetching enrollments:",a)}finally{i(!1)}})()},[n]);const O=[{header:"Participate Name",accessor:s=>s.student?.fullName||"-"},{header:"Email",accessor:s=>s.student?.email||"-"},!n&&{header:V,accessor:s=>{const a=s.enrollment?.enrolledCourses?.length||0;return a>0?e.jsxs("button",{className:"text-blue-600 font-medium hover:underline",onClick:()=>{c(`/enrollments/${s.enrollment._id}/courses`,{state:{enrolledCourses:s.enrollment?.enrolledCourses||[]}})},children:[a," ",a===1?"Training":"Trainings"]}):"â€”"}},{header:"Enrolled At",accessor:s=>new Date(s.enrollment?.enrolledAt).toLocaleString()||"-"},{header:"Reset Password",accessor:s=>x(d,"enrollment","update")?e.jsx("button",{onClick:()=>h({...s.student,enrollmentId:s.enrollment._id}),className:"text-indigo-600 hover:underline text-sm font-medium",children:"Reset"}):null},{header:"Actions",accessor:s=>e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>c(`/enrollments/${s.enrollment._id}`),className:"text-white font-medium bg-blue-500 px-4 py-2 rounded-md",children:"View"}),x(d,"enrollment","update")&&e.jsx("button",{onClick:()=>c(`/enroll-student/${s.enrollment._id}`),className:"text-white font-medium bg-yellow-500 px-4 py-2 rounded-md",children:"Edit"}),x(d,"enrollment","delete")&&e.jsx("button",{onClick:async()=>{if((await r.fire({title:"Are you sure?",text:`Do you want to delete ${s.student?.fullName}'s enrollment?`,icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Yes, delete it!"})).isConfirmed)try{i(!0),await E.delete(`/api/enrollments/${s.enrollment._id}`),r.fire("Deleted!","Enrollment has been deleted.","success"),P(l=>l.filter(j=>j.enrollment._id!==s.enrollment._id))}catch(l){console.error(l),r.fire("Error",l.response?.data?.message||"Failed to delete enrollment.","error")}finally{i(!1)}},className:"text-white font-medium bg-red-500 px-4 py-2 rounded-md",children:"Delete"})]})}].filter(Boolean);return t.useEffect(()=>{(async()=>{if(n)try{C(!0);const a=await Y(n);console.log("Fetched batch:",a),A(a?.batchName||"")}catch(a){console.error("Error fetching batch:",a)}finally{C(!1)}})()},[n]),e.jsxs("div",{className:"flex flex-col max-h-screen bg-white font-sans",children:[e.jsxs("div",{className:"flex justify-between items-center px-8 py-2 bg-white shadow-md z-10",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-700",children:M?"Loading batch...":v?`Enrolled Participate list for ${v}`:"Manage Enrolled Participate"}),x(d,"enrollment","create")&&e.jsx("button",{onClick:()=>c("/enroll-student"),className:"px-4 py-2 bg-cyan-500 text-white rounded-lg hover:bg-cyan-600 transition",children:"+ Enroll New Participate"})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:e.jsx("div",{className:"max-w-7xl mx-auto",children:I?e.jsx("div",{className:"text-center text-gray-500 py-10 text-lg font-medium",children:"Loading enrollments..."}):e.jsx(z,{columns:O,data:_,maxHeight:"440px",emptyMessage:"No enrollments found."})})}),e.jsx(S,{isOpen:L,onClose:()=>T(!1),header:$==="courses"?"Training Enrolled":o?.student?.fullName||"Enrollment Details",children:o&&e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-gray-500 font-medium",children:"Participate Name"}),e.jsx("span",{className:"text-gray-800",children:o.student?.fullName})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-gray-500 font-medium",children:"Email"}),e.jsx("span",{className:"text-gray-800",children:o.student?.email})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-gray-500 font-medium",children:"Mobile"}),e.jsx("span",{className:"text-gray-800",children:o.student?.mobileNo})]})]})})}),e.jsx(S,{isOpen:!!m,onClose:()=>{h(null),b(""),p(""),w(!1),y(!1)},header:"Reset Password",primaryAction:{label:"Save",onClick:F},children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("p",{className:"text-sm text-gray-600",children:["Reset password for ",e.jsx("b",{children:m?.email})]}),e.jsxs("div",{className:"relative",children:[e.jsx("label",{className:"text-sm font-medium",children:"New Password"}),e.jsx("input",{type:g?"text":"password",value:u,onChange:s=>b(s.target.value),className:"w-full border p-2 rounded-lg pr-10"}),e.jsx("button",{type:"button",onClick:()=>w(!g),className:"absolute right-3 top-9 text-gray-500",children:g?e.jsx(B,{}):e.jsx(k,{})})]}),e.jsxs("div",{className:"relative",children:[e.jsx("label",{className:"text-sm font-medium",children:"Confirm Password"}),e.jsx("input",{type:N?"text":"password",value:f,onChange:s=>p(s.target.value),className:"w-full border p-2 rounded-lg pr-10"}),e.jsx("button",{type:"button",onClick:()=>y(!N),className:"absolute right-3 top-9 text-gray-500",children:N?e.jsx(B,{}):e.jsx(k,{})})]}),e.jsx("button",{type:"button",onClick:()=>D(6),className:"px-3 py-1 bg-indigo-600 text-white rounded-md",children:"Auto Generate"})]})})]})};export{Z as default};
