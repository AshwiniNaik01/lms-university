import{r as a,q as _,a as I,a1 as x,j as e,D as $,t as F,M as j,w as N,S as g}from"./index-BlaCQYdb.js";const K=()=>{const[y,S]=a.useState([]),[l,v]=a.useState(""),[A,o]=a.useState([]),[r,D]=a.useState(null),[w,u]=a.useState(!1),{rolePermissions:p}=_(t=>t.permissions),[T,f]=a.useState(!1),[c,h]=a.useState(null),[M,b]=a.useState(!1),[P,m]=a.useState("Please select the batch"),C=I();a.useEffect(()=>{x.get("/api/batches/all").then(t=>{const d=(Array.isArray(t.data.data)?t.data.data:[]).map(i=>({_id:i._id,name:i.batchName}));S(d)}).catch(t=>console.error("Error fetching batches:",t))},[]),a.useEffect(()=>{if(!l){o([]),m("Please select the batch");return}x.get(`/api/meetings/batch/${l}`).then(t=>{const s=Array.isArray(t.data.data)?t.data.data:[];o(s),m(s.length===0?"No sessions found for this batch":"")}).catch(t=>{console.error("Error fetching sessions:",t),t.response?.status===404&&t.response?.data?.message?(o([]),m(t.response.data.message)):(o([]),m("Failed to fetch sessions"))})},[l]);const E=t=>{D(t),u(!0)},L=t=>{t.attendanceDone?g.fire({icon:"info",title:"Attendance Already Done",text:"You have already marked attendance for this session.",confirmButtonText:"OK"}):C(`/attendance/${t._id}`,{state:{meeting:t}})},O=async t=>{try{b(!0);const s=await x.get(`/api/attendance/meeting/${t._id}`);if(s.data.success&&s.data.data?.record){const i=s.data.data.record.attendees?.map(n=>({fullName:n.studentDetails?.fullName||"-",email:n.studentDetails?.email||"-",mobileNo:n.studentDetails?.mobileNo||"-",program:n.studentDetails?.selectedProgram||"-",status:n.present?"Present":"Absent"}))||[],k=i.filter(n=>n.status==="Present").length,V=i.filter(n=>n.status==="Absent").length;h({presentCount:k,absentCount:V,students:i}),f(!0)}else{const d=s.data.message||"No attendance records found for this session.";g.fire("Info",d,"info"),h(null)}}catch(s){console.error(s);const d=s.response?.data?.message||"Failed to fetch attendance data.";g.fire("Warning",d,"warning"),h(null)}finally{b(!1)}},B=[{header:"Title",accessor:"title"},{header:"Platform",accessor:"platform"},{header:"Date",accessor:t=>t.startTime?new Date(t.startTime).toLocaleDateString():"-"},{header:"Start Time",accessor:t=>t.startTime?new Date(t.startTime).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):"-"},{header:"End Time",accessor:t=>t.endTime?new Date(t.endTime).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):"-"},{header:"Trainer",accessor:t=>t.trainer?.fullName||"-"},{header:"Actions",accessor:t=>e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:()=>E(t),className:"px-3 py-1.5 bg-indigo-500 text-white text-xs font-semibold rounded-md shadow-sm hover:bg-indigo-600 transition-all",children:"View"}),N(p,"attendance","create")&&!t.attendanceDone&&e.jsx("button",{onClick:()=>L(t),className:"px-3 py-1.5 bg-green-500 text-white text-xs font-semibold rounded-md shadow-sm hover:bg-green-600 transition-all",children:"Attendance"}),N(p,"attendance","read")&&e.jsx("button",{onClick:()=>O(t),className:"px-3 py-1.5 bg-purple-500 text-white text-xs font-semibold rounded-md shadow-sm hover:bg-purple-600 transition-all",children:"View Attendance"})]})}];return e.jsxs("div",{className:"p-4",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Manage Sessions"}),e.jsx($,{label:"Batch",name:"batch",options:y,formik:{values:{batch:l},setFieldValue:(t,s)=>v(s),touched:{},errors:{}}}),e.jsx("div",{className:"mt-6",children:e.jsx(F,{columns:B,data:A,maxHeight:"500px",emptyMessage:P})}),e.jsx(j,{isOpen:w,onClose:()=>u(!1),header:"Session Details",children:r?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-indigo-700",children:r.title}),e.jsx("p",{className:"text-gray-600",children:r.description})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Platform:"})," ",r.platform||"-"]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Start Time:"})," ",new Date(r.startTime).toLocaleString()]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"End Time:"})," ",new Date(r.endTime).toLocaleString()]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Session ID:"})," ",r.meetingId]})]})]}):e.jsx("p",{className:"text-gray-600",children:"No session selected."})}),e.jsx(j,{isOpen:T,onClose:()=>f(!1),header:"Attendance Details",children:M?e.jsx("p",{className:"text-gray-500 text-center py-4",children:"Loading attendance..."}):c?e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{className:"flex justify-around text-center font-semibold",children:[e.jsxs("div",{className:"bg-green-100 text-green-800 px-4 py-2 rounded-lg shadow-sm",children:["Present: ",c.presentCount??0]}),e.jsxs("div",{className:"bg-red-100 text-red-800 px-4 py-2 rounded-lg shadow-sm",children:["Absent: ",c.absentCount??0]})]}),e.jsx("div",{className:"mt-4 border rounded-lg overflow-hidden shadow-sm",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-indigo-50 text-indigo-900",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left",children:"Participate Name"}),e.jsx("th",{className:"px-4 py-2 text-left",children:"Email"}),e.jsx("th",{className:"px-4 py-2 text-left",children:"Status"})]})}),e.jsx("tbody",{children:c.students?.length?c.students.map((t,s)=>e.jsxs("tr",{className:"border-b last:border-none hover:bg-indigo-50",children:[e.jsx("td",{className:"px-4 py-2",children:t.fullName}),e.jsx("td",{className:"px-4 py-2",children:t.email}),e.jsx("td",{className:`px-4 py-2 font-medium ${t.status==="Present"?"text-green-600":"text-red-600"}`,children:t.status})]},s)):e.jsx("tr",{children:e.jsx("td",{colSpan:"3",className:"text-center py-4 text-gray-500 italic",children:"No attendance data available."})})})]})})]}):e.jsx("p",{className:"text-gray-500 text-center",children:"No data to display."})})]})};export{K as default};
