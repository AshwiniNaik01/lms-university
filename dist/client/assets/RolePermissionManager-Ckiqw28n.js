import{r,a1 as n,j as t,l as _,M as $,S as d,a5 as N}from"./index-BlaCQYdb.js";const x=["create","read","update","delete"],L=()=>{const[w,g]=r.useState([]),[i,v]=r.useState([]),[o,R]=r.useState(""),[m,S]=r.useState(""),[p,f]=r.useState({}),[y,c]=r.useState(!1),[C,b]=r.useState(!1),[E,u]=r.useState(!1),[h,j]=r.useState("");r.useEffect(()=>{(async()=>{try{const e=await n.get("/api/role");g(e.data.message||[])}catch(e){console.error("Error fetching roles",e)}})()},[]),r.useEffect(()=>{(async()=>{try{const e=await n.get("/api/module");if(e.data.success&&Array.isArray(e.data.data)){const a=e.data.data.map(l=>({module:l.module.toLowerCase(),label:l.module}));v(a)}}catch(e){console.error("Error fetching modules",e)}})()},[]),r.useEffect(()=>{o&&(c(!0),n.get(`/api/role/${o}`).then(s=>{const e=s.data.message;S(e.role);const a={};e.permissions.length===1&&e.permissions[0].module==="*"?i.forEach(l=>{a[l.module]=[...x]}):(i.forEach(l=>a[l.module]=[]),e.permissions.forEach(l=>{a[l.module]=l.actions})),f(a)}).catch(console.error).finally(()=>c(!1)))},[o,i]);const M=(s,e)=>{f(a=>{const l=a[s]||[],P=l.includes(e)?l.filter(O=>O!==e):[...l,e];return{...a,[s]:P}})},A=async()=>{c(!0);const s={role:m,permissions:Object.entries(p).filter(([e,a])=>a.length>0).map(([e,a])=>({module:e,actions:a}))};try{let e;o?e=await n.put(`/api/role/${o}`,s):e=await n.post("/api/role",s),d.fire({icon:"success",title:`${e?.data?.message}`||"Permissions saved successfully!"}),console.log(e.data)}catch(e){console.error(e),d.fire({icon:"error",title:N(e)})}finally{c(!1)}},k=async()=>{if(!h.trim())return d.fire({icon:"warning",title:"Role name is required!"});b(!0);try{const s={role:h.trim().toLowerCase()},e=await n.post("/api/role",s);d.fire({icon:"success",title:`${e?.data?.success}`||"New role added successfully!",showConfirmButton:!0}),g(a=>[...a,e.data.message]),u(!1),j("")}catch(s){console.error(s);const e=N(s);d.fire({icon:"error",title:e||"Error creating role."})}finally{b(!1)}};return t.jsxs("div",{className:"p-8 bg-gray-50 max-h-screen relative",children:[t.jsxs("div",{className:"flex justify-between items-center mb-8",children:[t.jsxs("div",{children:[t.jsx("h1",{className:"text-3xl font-extrabold text-indigo-700 mb-2",children:"Role Permission Manager"}),t.jsx("p",{className:"text-gray-500",children:"Assign and manage access for roles."})]}),t.jsxs("button",{onClick:()=>u(!0),className:"flex items-center gap-2 bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-lg shadow-md",children:[t.jsx(_,{})," Add New Role"]})]}),t.jsxs("div",{className:"bg-white shadow-lg rounded-xl p-6 mb-8 border border-gray-200",children:[t.jsx("label",{className:"block text-gray-700 font-semibold mb-3",children:"Select Role"}),t.jsxs("select",{value:o,onChange:s=>R(s.target.value),className:"w-64 border border-gray-300 rounded-lg px-4 py-2",children:[t.jsx("option",{value:"",children:"-- Select Role --"}),w.map(s=>t.jsx("option",{value:s._id,children:s.role.toUpperCase()},s._id))]})]}),o&&i.length>0&&t.jsx("div",{className:"bg-white shadow-lg rounded-xl border border-gray-200 overflow-x-auto mb-6",children:t.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[t.jsx("thead",{className:"bg-indigo-50",children:t.jsxs("tr",{children:[t.jsx("th",{className:"px-6 py-3 text-left text-sm font-semibold text-gray-700",children:"Module"}),x.map(s=>t.jsx("th",{className:"px-6 py-3 text-center text-sm font-semibold text-gray-700",children:s.toUpperCase()},s))]})}),t.jsx("tbody",{children:i.map(s=>t.jsxs("tr",{className:"hover:bg-indigo-50 transition",children:[t.jsx("td",{className:"px-6 py-4 text-gray-800 font-medium",children:s.label}),x.map(e=>t.jsx("td",{className:"px-6 py-4 text-center",children:t.jsx("input",{type:"checkbox",checked:p[s.module]?.includes(e),onChange:()=>M(s.module,e),disabled:m==="admin"||m==="super_admin",className:"h-5 w-5 text-indigo-600"})},e))]},s.module))})]})}),o&&t.jsx("div",{className:"flex justify-end",children:t.jsx("button",{onClick:A,disabled:y,className:"bg-indigo-600 hover:bg-indigo-700 text-white px-6 py-3 rounded-xl shadow-md",children:y?"Saving...":"Save Permissions"})}),t.jsx($,{isOpen:E,onClose:()=>u(!1),header:"Add New Role",primaryAction:{label:"Create Role",onClick:k,loading:C},children:t.jsxs("div",{className:"flex flex-col gap-4",children:[t.jsx("label",{className:"text-gray-700 font-medium",children:"Role Name*"}),t.jsx("input",{type:"text",value:h,onChange:s=>j(s.target.value),placeholder:"e.g., trainer",className:"w-full border border-gray-300 rounded-lg px-4 py-2"})]})})]})};export{L as default};
