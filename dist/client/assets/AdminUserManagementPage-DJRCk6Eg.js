import{r as t,u as ne,j as e,t as ie,M as V,aG as f,x as g,a1 as m,S as n}from"./index-BlaCQYdb.js";import{T as de}from"./ToggleSwitch-gbKbv7D8.js";import{u as D}from"./usePassword-DK4VtSSf.js";const ce=()=>{const[U,$]=t.useState([]),[k,L]=t.useState(""),[H,F]=t.useState(!0),[u,N]=t.useState(null),[b,w]=t.useState(""),{password:x,setPassword:j,generate:q}=D(""),[y,J]=t.useState(!1),[v,_]=t.useState(!1),[C,B]=t.useState(!1),{token:o}=ne(),[P,S]=t.useState(!1),[i,A]=t.useState({firstName:"",lastName:"",email:"",password:"",mobileNo:"",role:""}),[K,M]=t.useState(!1),[T,z]=t.useState(""),[Q,W]=t.useState({}),[G,X]=t.useState([]),[d,Y]=t.useState("admin"),{password:E,setPassword:I,generate:Z}=D(""),O=s=>{W(a=>({...a,[s]:!a[s]}))};t.useEffect(()=>{A(s=>({...s,password:E}))},[E]),t.useEffect(()=>{o&&(async()=>{try{const a=await m.get("/api/role",{headers:{Authorization:`Bearer ${o}`}});X(a.data.message||[])}catch(a){console.error("Error fetching roles",a)}})()},[o]);const R=async(s="")=>{F(!0);try{const a=await m.post("/api/users",{role:s},{headers:{Authorization:`Bearer ${o}`}}),r=a.data.data?.users||[],h=a.data.data?.trainers||[],re=(s?[...r.filter(l=>l.role===s),...h.filter(l=>l.role===s)]:[...r,...h]).sort((l,p)=>{const oe=l.firstName?`${l.firstName} ${l.lastName}`:l.fullName,le=p.firstName?`${p.firstName} ${p.lastName}`:p.fullName;return oe.localeCompare(le)});$(re),L("")}catch(a){L("Failed to load users."),console.error(a)}finally{F(!1)}};t.useEffect(()=>{o&&R(d)},[o,d]),t.useEffect(()=>{P&&I("")},[P]);const ee=async s=>{try{await m.post("/api/auth/logout",{_id:s._id,role:s.role},{headers:{Authorization:`Bearer ${o}`}}),$(a=>a.map(r=>r._id===s._id?{...r,isLogin:!r.isLogin}:r)),n.fire("Success",`${s.firstName||s.fullName} login permission ${s.isLogin?"revoked":"activated"}`,"success")}catch(a){console.error("Failed to toggle login permission",a),n.fire("Error","Failed to toggle login permission","error")}},se=async()=>{if(!x||!b){n.fire("Error","Password fields cannot be empty","error");return}if(x!==b){n.fire("Error","Passwords do not match","error");return}try{await m.put("/api/auth/reset-password",{email:u.email,role:u.role,newPassword:x},{headers:{Authorization:`Bearer ${o}`}}),n.fire("Success","Password reset successfully","success"),await R(d),N(null),j(""),w("")}catch(s){n.fire("Error",s.response?.data?.message||"Failed to reset password","error")}},ae=[{header:"Name",accessor:s=>s.firstName?`${s.firstName} ${s.lastName}`:s.fullName},{header:"Email",accessor:"email"},{header:"Role",accessor:s=>s.role?s.role.charAt(0).toUpperCase()+s.role.slice(1):""},{header:"Login Permission",accessor:s=>e.jsx(de,{label:"",name:`login-${s._id}`,checked:s.isLogin,onChange:()=>ee(s)})},{header:"Password",accessor:s=>{const a=Q[s._id]||!1,r=s.password||"";return e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{children:a?r:""}),e.jsx("button",{type:"button",onClick:()=>O(s._id),className:"text-gray-500 hover:text-gray-700",children:a?e.jsx(f,{}):e.jsx(g,{})})]})}},{header:"Reset Password",accessor:s=>e.jsx("button",{onClick:()=>N(s),className:"text-indigo-600 hover:underline text-sm font-medium",children:"Reset"})}],c=s=>{const{name:a,value:r}=s.target;A(h=>({...h,[a]:r}))},te=async()=>{M(!0),z("");try{const s=await m.post("/api/auth/register",i,{headers:{Authorization:`Bearer ${o}`}});S(!1),A({firstName:"",lastName:"",email:"",password:"",mobileNo:"",role:""}),await R(d),n.fire({icon:"success",title:"Success",text:s.data.message||"User added successfully!",timer:2e3,showConfirmButton:!1})}catch(s){z(s.response?.data?.message||"Failed to add user"),n.fire({icon:"error",title:"Error",text:s.response?.data?.message||"Failed to add user"}),console.error(s)}finally{M(!1)}};return H?e.jsx("p",{className:"text-center py-12 animate-pulse",children:"Loading users..."}):k?e.jsx("p",{className:"text-center py-12 text-red-500",children:k}):e.jsxs("div",{className:"min-h-screen bg-gray-50 p-4",children:[e.jsxs("div",{className:"max-w-7xl mx-auto bg-white rounded-lg shadow overflow-hidden",children:[e.jsxs("header",{className:"px-6 py-5 border-b flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsx("h1",{className:"text-3xl font-bold text-indigo-900",children:"User Management"}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Filter by Role"}),e.jsx("select",{value:d,onChange:s=>Y(s.target.value),className:"border border-gray-300 rounded-md px-3 py-2 text-sm focus:ring-2 focus:ring-indigo-500",children:G.map(s=>e.jsx("option",{value:s.role,children:s.role.charAt(0).toUpperCase()+s.role.slice(1)},s._id))})]}),e.jsx("button",{onClick:()=>S(!0),className:"px-4 py-2 bg-indigo-600 text-white text-sm font-medium rounded-md hover:bg-indigo-700 transition",children:"+ Add User"})]})]}),e.jsx("div",{className:"p-4",children:U.length===0?e.jsxs("div",{className:"text-center py-16",children:[e.jsx("p",{className:"text-gray-500 text-lg",children:"No users found"}),e.jsx("p",{className:"text-sm text-gray-400 mt-1",children:"Try changing the filter or add a new user"})]}):e.jsx(ie,{columns:ae,data:U,maxHeight:"460px"})})]}),e.jsx(V,{isOpen:P,onClose:()=>S(!1),header:"Add New User",primaryAction:{label:"Add User",onClick:te,loading:K},children:e.jsxs("div",{className:"space-y-6",children:[T&&e.jsx("div",{className:"p-3 bg-red-50 border border-red-200 text-red-700 rounded-md text-sm",children:T}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 mb-1",children:"First Name*"}),e.jsx("input",{type:"text",name:"firstName",placeholder:"First Name",value:i.firstName,onChange:c,className:"input border-2 border-blue-100 p-2 rounded-lg"})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 mb-1",children:"Last Name*"}),e.jsx("input",{type:"text",name:"lastName",placeholder:"Last Name",value:i.lastName,onChange:c,className:"input border-2 border-blue-100 p-2 rounded-lg"})]})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 mb-1",children:"Email*"}),e.jsx("input",{type:"email",name:"email",value:i.email,onChange:c,className:"input border-2 border-blue-100 p-2 rounded-lg"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"flex flex-col relative",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 mb-1",children:"Password*"}),e.jsxs("div",{className:"flex items-center relative",children:[e.jsx("input",{type:y?"text":"password",name:"password",value:E,onChange:s=>I(s.target.value),className:"w-full pr-10 border-2 border-blue-100 p-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400"}),e.jsx("button",{type:"button",onClick:()=>J(!y),className:"relative right-5 text-gray-500 hover:text-gray-700",children:y?e.jsx(f,{}):e.jsx(g,{})}),e.jsx("button",{type:"button",onClick:()=>Z(6),className:"ml-2 px-3 py-1 bg-indigo-600 text-white text-sm rounded-md hover:bg-indigo-700 transition",children:"Auto Generate"})]})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 mb-1",children:"Mobile Number*"}),e.jsx("input",{type:"text",name:"mobileNo",value:i.mobileNo,onChange:c,className:"w-full border-2 border-blue-100 p-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400"})]})]}),e.jsxs("div",{className:"flex flex-col w-50",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 mb-1",children:"Role*"}),e.jsxs("select",{name:"role",value:i.role,onChange:c,className:"input border-2 border-blue-100 p-2 rounded-lg",children:[e.jsx("option",{value:"",children:"Select Role"}),G.map(s=>e.jsx("option",{value:s.role,children:s.role.charAt(0).toUpperCase()+s.role.slice(1)},s._id))]})]})]})}),e.jsx(V,{isOpen:!!u,onClose:()=>{N(null),j(""),w(""),_(!1),B(!1)},header:"Reset Password",primaryAction:{label:"Save",onClick:se},children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("p",{className:"text-sm text-gray-600",children:["Reset password for ",e.jsx("b",{children:u?.email})]}),e.jsxs("div",{className:"relative",children:[e.jsx("label",{className:"text-sm font-medium",children:"New Password"}),e.jsx("input",{type:v?"text":"password",value:x,onChange:s=>j(s.target.value),className:"w-full border p-2 rounded-lg pr-10"}),e.jsx("button",{type:"button",onClick:()=>_(!v),className:"absolute right-3 top-9 text-gray-500",children:v?e.jsx(f,{}):e.jsx(g,{})})]}),e.jsxs("div",{className:"relative",children:[e.jsx("label",{className:"text-sm font-medium",children:"Confirm Password"}),e.jsx("input",{type:C?"text":"password",value:b,onChange:s=>w(s.target.value),className:"w-full border p-2 rounded-lg pr-10"}),e.jsx("button",{type:"button",onClick:()=>B(!C),className:"absolute right-3 top-9 text-gray-500",children:C?e.jsx(f,{}):e.jsx(g,{})})]}),e.jsx("button",{type:"button",onClick:()=>q(6),className:"px-3 py-1 bg-indigo-600 text-white rounded-md",children:"Auto Generate"})]})})]})},pe=()=>e.jsx("div",{children:e.jsx(ce,{})});export{pe as default};
